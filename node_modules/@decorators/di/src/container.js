"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const store_1 = require("./store");
const errors_1 = require("./errors");
class Container {
    /**
     * Register new or replace providers
     *
     * @static
     * @param {Provider[]} providers
     */
    static provide(providers) {
        providers
            .filter((_provider) => _provider.useClass)
            .forEach((_provider) => this.registerClassProvider(_provider));
        providers
            .filter((_provider) => _provider.useFactory)
            .forEach((_provider) => this.registerFactoryProvider(_provider));
        providers
            .filter((_provider) => _provider.useValue)
            .forEach((_provider) => this.registerValueProvider(_provider));
    }
    /**
     * Get instance of injectable
     *
     * @template T
     * @param {Injectable} injectable
     * @returns {T}
     */
    static get(injectable) {
        const provider = store_1.Store.findProvider(injectable);
        if (provider === undefined) {
            throw new errors_1.MissingProviderError(injectable);
        }
        return this.resolveProvider(provider);
    }
    /**
     * Resolve provider
     *
     * @private
     * @param {StoreProvider} provider
     * @param {StoreProvider[]} [requesters = []] provider, that initiated di
     * @returns {*}
     */
    static resolveProvider(provider, requesters = []) {
        if (provider.value) {
            return provider.value;
        }
        const _requesters = requesters.concat([provider]);
        const deps = provider
            .deps.map((dep) => {
            const requesterProvider = _requesters.find((requester) => requester.id === dep.id);
            if (requesterProvider) {
                throw new errors_1.RecursiveProviderError(_requesters, requesterProvider);
            }
            const depService = store_1.Store.findProvider(dep.id);
            if (!depService && !dep.optional) {
                throw new errors_1.MissingProviderError(provider, dep);
            }
            if (!depService && dep.optional) {
                return null;
            }
            return this.resolveProvider(depService, _requesters);
        });
        provider.value = provider.factory ?
            provider.factory(...deps) : new provider.type(...deps);
        return provider.value;
    }
    /**
     * Register class provider
     *
     * @private
     * @static
     * @param {ClassProvider} provider
     */
    static registerClassProvider(provider) {
        const id = store_1.Store.providerId(provider.provide);
        const classProvider = store_1.Store.findProvider(provider.useClass);
        const deps = classProvider ? classProvider.deps : (provider.deps || [])
            .map((dep) => ({ id: store_1.Store.providerId(dep) }));
        store_1.Store.replaceProvider(provider.provide, { id, deps, type: provider.useClass });
    }
    /**
     * Register factory provider
     *
     * @private
     * @static
     * @param {FactoryProvider} provider
     */
    static registerFactoryProvider(provider) {
        const id = store_1.Store.providerId(provider.provide);
        const factory = provider.useFactory;
        const deps = (provider.deps || [])
            .map((dep) => ({ id: store_1.Store.providerId(dep) }));
        store_1.Store.replaceProvider(provider.provide, { id, factory, deps });
    }
    /**
     * Register value provider
     *
     * @private
     * @static
     * @param {ValueProvider} provider
     * @memberof Container
     */
    static registerValueProvider(provider) {
        const id = store_1.Store.providerId(provider.provide);
        const value = provider.useValue;
        store_1.Store.replaceProvider(provider.provide, { id, value });
    }
}
exports.Container = Container;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29udGFpbmVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiY29udGFpbmVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBV0EsbUNBQWdDO0FBQ2hDLHFDQUF3RTtBQUV4RTtJQUVFOzs7OztPQUtHO0lBQ0ksTUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFxQjtRQUN6QyxTQUFTO2FBQ04sTUFBTSxDQUFDLENBQUMsU0FBd0IsRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQzthQUN4RCxPQUFPLENBQUMsQ0FBQyxTQUF3QixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUVoRixTQUFTO2FBQ04sTUFBTSxDQUFDLENBQUMsU0FBMEIsRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQzthQUM1RCxPQUFPLENBQUMsQ0FBQyxTQUEwQixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMsdUJBQXVCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztRQUVwRixTQUFTO2FBQ04sTUFBTSxDQUFDLENBQUMsU0FBd0IsRUFBRSxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQzthQUN4RCxPQUFPLENBQUMsQ0FBQyxTQUF3QixFQUFFLEVBQUUsQ0FBQyxJQUFJLENBQUMscUJBQXFCLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQztJQUNsRixDQUFDO0lBRUQ7Ozs7OztPQU1HO0lBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBSSxVQUFzQjtRQUN6QyxNQUFNLFFBQVEsR0FBa0IsYUFBSyxDQUFDLFlBQVksQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUUvRCxFQUFFLENBQUMsQ0FBQyxRQUFRLEtBQUssU0FBUyxDQUFDLENBQUMsQ0FBQztZQUMzQixNQUFNLElBQUksNkJBQW9CLENBQUMsVUFBVSxDQUFDLENBQUM7UUFDN0MsQ0FBQztRQUVELE1BQU0sQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFD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LFVBQVUsQ0FBQztRQUM3QyxNQUFNLElBQUksR0FBaUIsQ0FBQyxRQUFRLENBQUMsSUFBSSxJQUFJLEVBQUUsQ0FBQzthQUM3QyxHQUFHLENBQUMsQ0FBQyxHQUFlLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEVBQUUsYUFBSyxDQUFDLFVBQVUsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUU3RCxhQUFLLENBQUMsZUFBZSxDQUFDLFFBQVEsQ0FBQyxPQUFPLEVBQUUsRUFBRSxFQUFFLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUE7SUFDaEUsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSyxNQUFNLENBQUMscUJBQXFCLENBQUMsUUFBdUI7UUFDMUQsTUFBTSxFQUFFLEdBQWlCLGFBQUssQ0FBQyxVQUFVLENBQUMsUUFBUSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQzVELE1BQU0sS0FBSyxHQUFRLFFBQVEsQ0FBQyxRQUFRLENBQUM7UUFFckMsYUFBSyxDQUFDLGVBQWUsQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLEVBQUUsRUFBRSxFQUFFLEtBQUssRUFBRSxDQUFDLENBQUM7SUFDekQsQ0FBQztDQUVGO0FBaklELDhCQWlJQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIEluamVjdGFibGVJZCxcbiAgUHJvdmlkZXIsXG4gIFN0b3JlUHJvdmlkZXIsXG4gIENsYXNzUHJvdmlkZXIsXG4gIEZhY3RvcnlQcm92aWRlcixcbiAgVmFsdWVQcm92aWRlcixcbiAgRGVwZW5kZW5jeSxcbiAgSW5qZWN0YWJsZSxcbiAgRmFjdG9yeVxufSBmcm9tICcuL3R5cGVzJztcbmltcG9ydCB7IFN0b3JlIH0gZnJvbSAnLi9zdG9yZSc7XG5pbXBvcnQgeyBNaXNzaW5nUHJvdmlkZXJFcnJvciwgUmVjdXJzaXZlUHJvdmlkZXJFcnJvciB9IGZyb20gJy4vZXJyb3JzJztcblxuZXhwb3J0IGNsYXNzIENvbnRhaW5lciB7XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIG5ldyBvciByZXBsYWNlIHByb3ZpZGVyc1xuICAgKlxuICAgKiBAc3RhdGljXG4gICAqIEBwYXJhbSB7UHJvdmlkZXJbXX0gcHJvdmlkZXJzXG4gICAqL1xuICBwdWJsaWMgc3RhdGljIHByb3ZpZGUocHJvdmlkZXJzOiBQcm92aWRlcltdKSB7XG4gICAgcHJvdmlkZXJzXG4gICAgICAuZmlsdGVyKChfcHJvdmlkZXI6IENsYXNzUHJvdmlkZXIpID0+IF9wcm92aWRlci51c2VDbGFzcylcbiAgICAgIC5mb3JFYWNoKChfcHJvdmlkZXI6IENsYXNzUHJvdmlkZXIpID0+IHRoaXMucmVnaXN0ZXJDbGFzc1Byb3ZpZGVyKF9wcm92aWRlcikpO1xuXG4gICAgcHJvdmlkZXJzXG4gICAgICAuZmlsdGVyKChfcHJvdmlkZXI6IEZhY3RvcnlQcm92aWRlcikgPT4gX3Byb3ZpZGVyLnVzZUZhY3RvcnkpXG4gICAgICAuZm9yRWFjaCgoX3Byb3ZpZGVyOiBGYWN0b3J5UHJvdmlkZXIpID0+IHRoaXMucmVnaXN0ZXJGYWN0b3J5UHJvdmlkZXIoX3Byb3ZpZGVyKSk7XG5cbiAgICBwcm92aWRlcnNcbiAgICAgIC5maWx0ZXIoKF9wcm92aWRlcjogVmFsdWVQcm92aWRlcikgPT4gX3Byb3ZpZGVyLnVzZVZhbHVlKVxuICAgICAgLmZvckVhY2goKF9wcm92aWRlcjogVmFsdWVQcm92aWRlcikgPT4gdGhpcy5yZWdpc3RlclZhbHVlUHJvdmlkZXIoX3Byb3ZpZGVyKSk7XG4gIH1cblxuICAvKipcbiAgICogR2V0IGluc3RhbmNlIG9mIGluamVjdGFibGVcbiAgICpcbiAgICogQHRlbXBsYXRlIFRcbiAgICogQHBhcmFtIHtJbmplY3RhYmxlfSBpbmplY3RhYmxlXG4gICAqIEByZXR1cm5zIHtUfVxuICAgKi9cbiAgcHVibGljIHN0YXRpYyBnZXQ8VD4oaW5qZWN0YWJsZTogSW5qZWN0YWJsZSk6IFQge1xuICAgIGNvbnN0IHByb3ZpZGVyOiBTdG9yZVByb3ZpZGVyID0gU3RvcmUuZmluZFByb3ZpZGVyKGluamVjdGFibGUpO1xuXG4gICAgaWYgKHByb3ZpZGVyID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHRocm93IG5ldyBNaXNzaW5nUHJvdmlkZXJFcnJvcihpbmplY3RhYmxlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5yZXNvbHZlUHJvdmlkZXIocHJvdmlkZXIpXG4gIH1cblxuICAvKipcbiAgICogUmVzb2x2ZSBwcm92aWRlclxuICAgKlxuICAgKiBAcHJpdmF0ZVxuICAgKiBAcGFyYW0ge1N0b3JlUHJvdmlkZXJ9IHByb3ZpZGVyXG4gICAqIEBwYXJhbSB7U3RvcmVQcm92aWRlcltdfSBbcmVxdWVzdGVycyA9IFtdXSBwcm92aWRlciwgdGhhdCBpbml0aWF0ZWQgZGlcbiAgICogQHJldHVybnMgeyp9XG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyByZXNvbHZlUHJvdmlkZXIocHJvdmlkZXI6IFN0b3JlUHJvdmlkZXIsIHJlcXVlc3RlcnM6IFN0b3JlUHJvdmlkZXJbXSA9IFtdKTogYW55IHtcbiAgICBpZiAocHJvdmlkZXIudmFsdWUpIHtcbiAgICAgIHJldHVybiBwcm92aWRlci52YWx1ZTtcbiAgICB9XG5cbiAgICBjb25zdCBfcmVxdWVzdGVycyA9IHJlcXVlc3RlcnMuY29uY2F0KFtwcm92aWRlcl0pO1xuXG4gICAgY29uc3QgZGVwcyA9IHByb3ZpZGVyXG4gICAgICAuZGVwcy5tYXAoKGRlcDogRGVwZW5kZW5jeSkgPT4ge1xuICAgICAgICBjb25zdCByZXF1ZXN0ZXJQcm92aWRlcjogU3RvcmVQcm92aWRlciA9XG4gICAgICAgICAgX3JlcXVlc3RlcnMuZmluZCgocmVxdWVzdGVyOiBTdG9yZVByb3ZpZGVyKSA9PiByZXF1ZXN0ZXIuaWQgPT09IGRlcC5pZCk7XG5cbiAgICAgICAgaWYgKHJlcXVlc3RlclByb3ZpZGVyKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IFJlY3Vyc2l2ZVByb3ZpZGVyRXJyb3IoX3JlcXVlc3RlcnMsIHJlcXVlc3RlclByb3ZpZGVyKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGRlcFNlcnZpY2U6IFN0b3JlUHJvdmlkZXIgPSBTdG9yZS5maW5kUHJvdmlkZXIoZGVwLmlkKTtcblxuICAgICAgICBpZiAoIWRlcFNlcnZpY2UgJiYgIWRlcC5vcHRpb25hbCkge1xuICAgICAgICAgIHRocm93IG5ldyBNaXNzaW5nUHJvdmlkZXJFcnJvcihwcm92aWRlciwgZGVwKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICghZGVwU2VydmljZSAmJiBkZXAub3B0aW9uYWwpIHtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLnJlc29sdmVQcm92aWRlcihkZXBTZXJ2aWNlLCBfcmVxdWVzdGVycyk7XG4gICAgICB9KTtcblxuICAgIHByb3ZpZGVyLnZhbHVlID0gcHJvdmlkZXIuZmFjdG9yeSA/XG4gICAgICBwcm92aWRlci5mYWN0b3J5KC4uLmRlcHMpIDogbmV3IHByb3ZpZGVyLnR5cGUoLi4uZGVwcyk7XG5cbiAgICByZXR1cm4gcHJvdmlkZXIudmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogUmVnaXN0ZXIgY2xhc3MgcHJvdmlkZXJcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHN0YXRpY1xuICAgKiBAcGFyYW0ge0NsYXNzUHJvdmlkZXJ9IHByb3ZpZGVyXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyByZWdpc3RlckNsYXNzUHJvdmlkZXIocHJvdmlkZXI6IENsYXNzUHJvdmlkZXIpOiB2b2lkIHtcbiAgICBjb25zdCBpZDogSW5qZWN0YWJsZUlkID0gU3RvcmUucHJvdmlkZXJJZChwcm92aWRlci5wcm92aWRlKTtcbiAgICBjb25zdCBjbGFzc1Byb3ZpZGVyOiBTdG9yZVByb3ZpZGVyID0gU3RvcmUuZmluZFByb3ZpZGVyKHByb3ZpZGVyLnVzZUNsYXNzKTtcbiAgICBjb25zdCBkZXBzOiBEZXBlbmRlbmN5W10gPSBjbGFzc1Byb3ZpZGVyID8gY2xhc3NQcm92aWRlci5kZXBzIDogKHByb3ZpZGVyLmRlcHMgfHwgW10pXG4gICAgICAubWFwKChkZXA6IEluamVjdGFibGUpID0+ICh7IGlkOiBTdG9yZS5wcm92aWRlcklkKGRlcCkgfSkpO1xuXG4gICAgU3RvcmUucmVwbGFjZVByb3ZpZGVyKHByb3ZpZGVyLnByb3ZpZGUsIHsgaWQsIGRlcHMsIHR5cGU6IHByb3ZpZGVyLnVzZUNsYXNzIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIGZhY3RvcnkgcHJvdmlkZXJcbiAgICpcbiAgICogQHByaXZhdGVcbiAgICogQHN0YXRpY1xuICAgKiBAcGFyYW0ge0ZhY3RvcnlQcm92aWRlcn0gcHJvdmlkZXJcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIHJlZ2lzdGVyRmFjdG9yeVByb3ZpZGVyKHByb3ZpZGVyOiBGYWN0b3J5UHJvdmlkZXIpOiB2b2lkIHtcbiAgICBjb25zdCBpZDogSW5qZWN0YWJsZUlkID0gU3RvcmUucHJvdmlkZXJJZChwcm92aWRlci5wcm92aWRlKTtcbiAgICBjb25zdCBmYWN0b3J5OiBGYWN0b3J5ID0gcHJvdmlkZXIudXNlRmFjdG9yeTtcbiAgICBjb25zdCBkZXBzOiBEZXBlbmRlbmN5W10gPSAocHJvdmlkZXIuZGVwcyB8fCBbXSlcbiAgICAgIC5tYXAoKGRlcDogSW5qZWN0YWJsZSkgPT4gKHsgaWQ6IFN0b3JlLnByb3ZpZGVySWQoZGVwKSB9KSk7XG5cbiAgICBTdG9yZS5yZXBsYWNlUHJvdmlkZXIocHJvdmlkZXIucHJvdmlkZSwgeyBpZCwgZmFjdG9yeSwgZGVwcyB9KVxuICB9XG5cbiAgLyoqXG4gICAqIFJlZ2lzdGVyIHZhbHVlIHByb3ZpZGVyXG4gICAqXG4gICAqIEBwcml2YXRlXG4gICAqIEBzdGF0aWNcbiAgICogQHBhcmFtIHtWYWx1ZVByb3ZpZGVyfSBwcm92aWRlclxuICAgKiBAbWVtYmVyb2YgQ29udGFpbmVyXG4gICAqL1xuICBwcml2YXRlIHN0YXRpYyByZWdpc3RlclZhbHVlUHJvdmlkZXIocHJvdmlkZXI6IFZhbHVlUHJvdmlkZXIpOiB2b2lkIHtcbiAgICBjb25zdCBpZDogSW5qZWN0YWJsZUlkID0gU3RvcmUucHJvdmlkZXJJZChwcm92aWRlci5wcm92aWRlKTtcbiAgICBjb25zdCB2YWx1ZTogYW55ID0gcHJvdmlkZXIudXNlVmFsdWU7XG5cbiAgICBTdG9yZS5yZXBsYWNlUHJvdmlkZXIocHJvdmlkZXIucHJvdmlkZSwgeyBpZCwgdmFsdWUgfSk7XG4gIH1cblxufVxuIl19